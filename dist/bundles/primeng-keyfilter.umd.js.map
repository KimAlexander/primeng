{"version":3,"file":"primeng-keyfilter.umd.js","sources":["ng://primeng/keyfilter/keyfilter.ts"],"sourcesContent":["import { NgModule, Directive, ElementRef, HostListener, Input, forwardRef, Output, EventEmitter } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DomHandler } from 'primeng/dom';\r\nimport { Validator, AbstractControl, NG_VALIDATORS } from '@angular/forms';\r\n\r\nexport const KEYFILTER_VALIDATOR: any = {\r\n    provide: NG_VALIDATORS,\r\n    useExisting: forwardRef(() => KeyFilter),\r\n    multi: true\r\n};\r\n\r\nconst DEFAULT_MASKS = {\r\n    pint: /[\\d]/,\r\n    'int': /[\\d\\-]/,\r\n    pnum: /[\\d\\.]/,\r\n    money: /[\\d\\.\\s,]/,\r\n    num: /[\\d\\-\\.]/,\r\n    hex: /[0-9a-f]/i,\r\n    email: /[a-z0-9_\\.\\-@]/i,\r\n    alpha: /[a-z_]/i,\r\n    alphanum: /[a-z0-9_]/i\r\n};\r\n\r\nconst KEYS = {\r\n    TAB: 9,\r\n    RETURN: 13,\r\n    ESC: 27,\r\n    BACKSPACE: 8,\r\n    DELETE: 46\r\n};\r\n\r\nconst SAFARI_KEYS = {\r\n    63234: 37, // left\r\n    63235: 39, // right\r\n    63232: 38, // up\r\n    63233: 40, // down\r\n    63276: 33, // page up\r\n    63277: 34, // page down\r\n    63272: 46, // delete\r\n    63273: 36, // home\r\n    63275: 35  // end\r\n};\r\n\r\n@Directive({\r\n    selector: '[pKeyFilter]',\r\n    providers: [KEYFILTER_VALIDATOR]\r\n})\r\nexport class KeyFilter implements Validator {\r\n\r\n    @Input() pValidateOnly: boolean;\r\n\r\n    @Output() ngModelChange: EventEmitter<any> = new EventEmitter();\r\n\r\n    regex: RegExp;\r\n\r\n    _pattern: any;\r\n\r\n    isAndroid: boolean;\r\n\r\n    lastValue: any;\r\n\r\n    constructor(public el: ElementRef) {\r\n        this.isAndroid = DomHandler.isAndroid();\r\n    }\r\n\r\n    get pattern(): any {\r\n        return this._pattern;\r\n    }\r\n\r\n    @Input('pKeyFilter') set pattern(_pattern: any) {\r\n        this._pattern = _pattern;\r\n        this.regex = DEFAULT_MASKS[this._pattern] || this._pattern;\r\n    }\r\n\r\n    isNavKeyPress(e: KeyboardEvent) {\r\n        let k = e.keyCode;\r\n        k = DomHandler.getBrowser().safari ? (SAFARI_KEYS[k] || k) : k;\r\n\r\n        return (k >= 33 && k <= 40) || k == KEYS.RETURN || k == KEYS.TAB || k == KEYS.ESC;\r\n    };\r\n\r\n    isSpecialKey(e: KeyboardEvent) {\r\n        let k = e.keyCode || e.charCode;\r\n\r\n        return k == 9 || k == 13 || k == 27 || k == 16 || k == 17 ||(k >= 18 && k <= 20) ||\r\n            (DomHandler.getBrowser().opera && !e.shiftKey && (k == 8 || (k >= 33 && k <= 35) || (k >= 36 && k <= 39) || (k >= 44 && k <= 45)));\r\n    }\r\n\r\n\r\n    getKey(e: KeyboardEvent) {\r\n        let k = e.keyCode || e.charCode;\r\n        return DomHandler.getBrowser().safari ? (SAFARI_KEYS[k] || k) : k;\r\n    }\r\n\r\n    getCharCode(e: KeyboardEvent) {\r\n        return e.charCode || e.keyCode || e.which;\r\n    }\r\n\r\n    findDelta(value: string, prevValue: string) {\r\n        let delta = '';\r\n\r\n        for (let i = 0; i < value.length; i++) {\r\n            let str = value.substr(0, i) + value.substr(i + value.length - prevValue.length);\r\n\r\n            if (str === prevValue)\r\n                delta = value.substr(i, value.length - prevValue.length);\r\n        }\r\n\r\n        return delta;\r\n    }\r\n\r\n    isValidChar(c: string) {\r\n        return this.regex.test(c);\r\n    }\r\n\r\n    isValidString(str: string) {\r\n        for (let i = 0; i < str.length; i++) {\r\n            if (!this.isValidChar(str.substr(i, 1))) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    @HostListener('input', ['$event'])\r\n    onInput(e: KeyboardEvent) {\r\n        if (this.isAndroid && !this.pValidateOnly) {\r\n            let val = this.el.nativeElement.value;\r\n            let lastVal = this.lastValue || '';\r\n\r\n            let inserted = this.findDelta(val, lastVal);\r\n            let removed = this.findDelta(lastVal, val);\r\n            let pasted = inserted.length > 1 || (!inserted && !removed);\r\n\r\n            if (pasted) {\r\n                if (!this.isValidString(val)) {\r\n                    this.el.nativeElement.value = lastVal;\r\n                    this.ngModelChange.emit(lastVal);\r\n                }\r\n            }\r\n            else if (!removed) {\r\n                if (!this.isValidChar(inserted)) {\r\n                    this.el.nativeElement.value = lastVal;\r\n                    this.ngModelChange.emit(lastVal);\r\n                }\r\n            }\r\n\r\n            val = this.el.nativeElement.value;\r\n            if (this.isValidString(val)) {\r\n                this.lastValue = val;\r\n            }\r\n        }\r\n    }\r\n\r\n    @HostListener('keypress', ['$event'])\r\n    onKeyPress(e: KeyboardEvent) {\r\n        if (this.isAndroid || this.pValidateOnly) {\r\n            return;\r\n        }\r\n\r\n        let browser = DomHandler.getBrowser();\r\n        let k = this.getKey(e);\r\n\r\n        if (browser.mozilla && (e.ctrlKey || e.altKey)) {\r\n            return;\r\n        }\r\n        else if (k == 17 || k == 18) {\r\n            return;\r\n        }\r\n\r\n        let c = this.getCharCode(e);\r\n        let cc = String.fromCharCode(c);\r\n        let ok = true;\r\n\r\n        if (!browser.mozilla && (this.isSpecialKey(e) || !cc)) {\r\n            return;\r\n        }\r\n\r\n        ok = this.regex.test(cc);\r\n\r\n        if (!ok) {\r\n            e.preventDefault();\r\n        }\r\n    }\r\n\r\n    @HostListener('paste', ['$event'])\r\n    onPaste(e) {\r\n        const clipboardData = e.clipboardData || (<any>window).clipboardData.getData('text');\r\n        if (clipboardData) {\r\n            const pastedText = clipboardData.getData('text');\r\n            for (let char of pastedText.toString()) {\r\n                if (!this.regex.test(char)) {\r\n                    e.preventDefault();\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    validate(c: AbstractControl): { [key: string]: any } {\r\n        if (this.pValidateOnly) {\r\n            let value = this.el.nativeElement.value;\r\n            if (value && !this.regex.test(value)) {\r\n                return {\r\n                    validatePattern: false\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n@NgModule({\r\n    imports: [CommonModule],\r\n    exports: [KeyFilter],\r\n    declarations: [KeyFilter]\r\n})\r\nexport class KeyFilterModule { }\r\n"],"names":["NG_VALIDATORS","forwardRef","EventEmitter","DomHandler","ElementRef","Input","Output","HostListener","Directive","NgModule","CommonModule"],"mappings":"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"}